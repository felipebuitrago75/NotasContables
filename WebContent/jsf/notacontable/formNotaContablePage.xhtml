<?xml version="1.0" encoding="ISO-8859-1"?>

<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" 
xmlns:a4j="http://richfaces.org/a4j" xmlns:rich="http://richfaces.org/rich">
	<head>
		<script type="text/javascript">
				function isDayEnabledNC(day){
					var fechaMin = document.getElementById('globalForm:fechaMin').value;
					var fechaMax = document.getElementById('globalForm:fechaMax').value;
				   	var min=new Date();
				   	min.setFullYear(parseInt(fechaMin.substring(6, 10), 10),parseInt(fechaMin.substring(3, 5), 10)-1,parseInt(fechaMin.substring(0, 2), 10)-1);
				   	var max=new Date();
				   	max.setFullYear(parseInt(fechaMax.substring(6, 10), 10),parseInt(fechaMax.substring(3, 5), 10)-1,parseInt(fechaMax.substring(0, 2), 10));
				   	var date = new Date(day.date);
				   	if(date.getDay() == 6){
						return false;	
					}
				   	if(date.getDay() == 0){
						return false;	
					}
				   	if(date &gt; min){
						if(max &gt; date){ //solo fechas entre min y max
							return true;
						}
					} 
					return false;
				}
				
				function isDayEnabledRiesgoNC(day){
				   	var max=new Date();
				   	var date = new Date(day.date);
					if(max &gt; date){ //solo fechas menores o iguales a hoy
						return true;
					}
					return false;
				}
				
				function getDisabledStyleNC(day){
				   if (!isDayEnabledNC(day)) return 'rich-calendar-boundary-dates disabledDay';
				}

				function getDisabledStyleRiesgoNC(day){
				   if (!isDayEnabledRiesgoNC(day)){ 
				   		return 'rich-calendar-boundary-dates disabledDay';
				   }
				}
				
				function validarMontoAlert(value){
					var alertCOP = parseFloat(document.getElementById('globalForm:montoAlertaCOP').value);
					var alertEXT = parseFloat(document.getElementById('globalForm:montoAlertaEXT').value);
					var divisa = document.getElementById('globalForm:codDivisaNotaContable').value;
					var warn=false;
					if(divisa == 'COP'){
						warn=value &gt; alertCOP;
					}else{
						warn=value &gt; alertEXT;
					}
					if(warn){
						alert('Por favor verifique si el importe ingresado es el adecuado.');
					}
				}
		</script>
		<style>
			.disabledDay{
			 background-color:#dedede;
			}
		</style>
	</head>
	<!-- Formulario de confirmacion de anulacion-->
	<rich:modalPanel id="popupAnularNota" autosized="true" domElementAttachment="form"  width="250">
		<f:facet name="header">
			<h:panelGroup><h:outputText value="Confirmación de anulación"/></h:panelGroup>
		</f:facet>
		<f:facet name="controls">
			<h:panelGroup>
				<h:graphicImage value="../../../common/images/close.png" alt="cerrar" styleClass="hidelink" id="hidelinkAnularNota" height="20" width="20" />
				<rich:componentControl for="popupAnularNota" attachTo="hidelinkAnularNota" operation="hide" event="onclick" />
			</h:panelGroup>
		</f:facet>
		
		<h:panelGrid columns="1" width="100%">
			
			<h:outputText value="Está seguro que desea anular la nota actual y borrar toda la información relacionada?" />

			<!-- Seccion de mensajes y botones de envio y cancelacion-->
			<ui:include src="../../common/mensajes.xhtml" /> 
			<h:panelGrid columns="2" styleClass="center" width="100%">
				<a4j:commandButton action="#{notaContablePage.anular}" value="Si" oncomplete="if (#{facesContext.maximumSeverity.ordinal==0}) {#{rich:component('popupAnularNota')}.hide(); #{rich:component('popupNotaContable')}.hide();}" reRender="botonesNotaContable,lista" />
				<a4j:commandButton onclick="#{rich:component('popupAnularNota')}.hide()" value="No" />
			</h:panelGrid>
		</h:panelGrid>
	</rich:modalPanel>
	<!-- Formulario Modal de creacion y edicion de temas por concepto-->
	<rich:modalPanel id="editor" domElementAttachment="form" autosized="true" minHeight="200" minWidth="840">
		<f:facet name="header">
			<h:panelGroup><h:outputText styleClass="bold" value="Tema: #{notaContablePage.temaActual.tema.nombre}"/></h:panelGroup>
		</f:facet>
		<h:inputHidden id="fechaMin" value="#{notaContablePage.minFecha}" /> 
		<h:inputHidden id="fechaMax" value="#{notaContablePage.maxFecha}" /> 
		<h:inputHidden id="montoAlertaCOP" value="#{notaContablePage.montoAlertaCOP}" /> 
		<h:inputHidden id="montoAlertaEXT" value="#{notaContablePage.montoAlertaEXT}" /> 
		
		<!-- Campos del formulario -->
        <h:panelGrid columns="1" width="840" id="informacion" cellpadding="0" cellspacing="0" >
        	<h:outputText>
	        	<div style="height:490px;overflow:auto;width: 100%;">
					<h:panelGrid columns="1" width="100%" cellpadding="0" cellspacing="0">
		
						<h:panelGrid columns="4" width="100%" cellpadding="0" cellspacing="2">
							<h:outputText  styleClass="bold" value="Fecha Contable" />
							<rich:calendar value="#{notaContablePage.temaActual.fechaContable}" isDayEnabled="isDayEnabledNC" dayStyleClass="getDisabledStyleNC" immediate="true">
								<a4j:support event="onchanged" action="#{notaContablePage.validarFecha}"  status="none" reRender="fecha"/>
							</rich:calendar>
							<a4j:commandButton action="#{notaContablePage.cargarModalRiesgo}" value="Riesgo Operacional" oncomplete="#{rich:component('modalRiesgo')}.show()" reRender="modalRiesgo" 
							rendered="#{notaContablePage.temaActual.tema.riesgoOperacional eq 'S'}" >
		                    </a4j:commandButton>							
							<a4j:commandButton value="Agregar Soportes" oncomplete="#{rich:component('modalSoportes')}.show()" reRender="modalSoportes" 
							rendered="#{notaContablePage.nota.concepto.soportes eq 'S'}" />
						</h:panelGrid>
						<h:panelGrid columns="2" width="100%"  cellpadding="0" cellspacing="3" style="height: 100%;" styleClass="aligntop">
							<rich:panel  header="Partida" style="width: 400px;">
			
								<h:panelGrid columns="1" width="100%" cellpadding="0" cellspacing="0">
									<h:panelGrid columns="5" >
										<h:outputText  styleClass="bold" value="Cuenta" />
										<h:outputText  styleClass="bold" value="#{notaContablePage.temaActual.tema.partidaContable}" style="font-weight: bold;"/>
										<rich:spacer width="50"/>
										<h:outputText  styleClass="bold" value="Naturaleza" />
										<h:outputText  styleClass="bold" value="#{notaContablePage.temaActual.tema.naturaleza1 eq 'D'?'Debe':'Haber'}" style="font-weight: bold;"/>
									</h:panelGrid>
									<h:panelGrid columns="2" id="sucursalPartida" >
										<h:outputText  styleClass="bold" value="Sucursal Destino" />
										<h:outputText  styleClass="bold" value="#{notaContablePage.usuarioLogueado.sucursal.codigo} #{notaContablePage.usuarioLogueado.sucursal.nombre}" rendered="#{notaContablePage.nota.concepto.origenDestino eq 'S'}" />
										<h:selectOneMenu value="#{notaContablePage.temaActual.codigoSucursalDestinoPartida}" immediate="true" rendered="#{notaContablePage.nota.concepto.origenDestino eq 'N'}"  style="width: 280px;">
											<a4j:support event="onchange" action="#{notaContablePage.cambiarSucursalPartida}" reRender="sucursalPartida,sucursalContraPartida"  />
											<f:selectItem itemValue="" itemLabel="Seleccione una opcion" />
											<f:selectItems value="#{notaContablePage.sucursalesPartida}" />
										</h:selectOneMenu>
										
										<h:outputText  styleClass="bold" value="Referencia" rendered="#{notaContablePage.temaActual.tema.referencia1 eq 'S'}"/>
										<h:inputText value="#{notaContablePage.temaActual.referencia1}" rendered="#{notaContablePage.temaActual.tema.referencia1 eq 'S'}" maxlength="12" size="12" onkeypress="return onKeyPressNumbersNoZero(event, this.value)"/>
									</h:panelGrid>
									<rich:panel header="Tercero" rendered="#{notaContablePage.temaActual.tema.tercero1 eq 'S'}"  style="width:100%; " >
										<h:panelGrid columns="2" id="documentoTercero1" >
											<h:outputText  styleClass="bold" value="Tipo de documento" />
											<h:selectOneMenu value="#{notaContablePage.temaActual.tipoIdentificacion1}" immediate="true" >
												<a4j:support event="onchange" reRender="filtroTercero1,tercero1" status="status" >
													<a4j:actionparam value="" assignTo="#{notaContablePage.temaActual.nombreCompleto1}"/>
												</a4j:support>
												<f:selectItem itemValue="" itemLabel="Seleccione una opcion" />
												<f:selectItems value="#{notaContablePage.tiposDoc}" />
											</h:selectOneMenu>
											
											<h:outputText  styleClass="bold" value="Numero Documento" />
											<h:panelGrid columns="2" border="0" cellpadding="0" cellspacing="0" style="padding-right: 0px;">
												<h:inputText value="#{notaContablePage.temaActual.numeroIdentificacion1}" size="15" immediate="true">
													<a4j:support event="onkeyup" reRender="filtroTercero1,tercero1" status="none" >
														<a4j:actionparam name="numDocRenN1" value="" assignTo="#{notaContablePage.temaActual.nombreCompleto1}"/>
													</a4j:support>
												</h:inputText>
												<h:panelGrid columns="1" id="filtroTercero1" cellspacing="0" cellpadding="0" style="padding-top: 0;" styleClass="aligntop">
													<a4j:commandButton style="padding-top: 0px;" action="#{notaContablePage.buscarTercero1}" reRender="documentoTercero1,tercero1,documentoTercero2,tercero2" value="Buscar" status="status"
													rendered="#{!empty notaContablePage.temaActual.tipoIdentificacion1 and !empty notaContablePage.temaActual.numeroIdentificacion1}"/>
												</h:panelGrid>
											</h:panelGrid>	
										</h:panelGrid>
										
										<h:panelGrid columns="1" id="tercero1"  cellpadding="0" cellspacing="0">
											<h:panelGrid columns="2" rendered="#{! empty notaContablePage.temaActual.nombreCompleto1}"  >
												
												<h:outputText  styleClass="bold" value="Dígito de Verificación" />
												<h:outputText  styleClass="bold" value="#{notaContablePage.temaActual.digitoVerificacion1}" />
											
												<h:outputText  styleClass="bold" value="Nombre" />
												<h:outputText  styleClass="bold" value="#{notaContablePage.temaActual.nombreCompleto1}" />
											
												<h:outputText  styleClass="bold" value="Contrato" rendered="#{notaContablePage.temaActual.tema.contrato1 eq 'S'}"/>
												<h:selectOneMenu value="#{notaContablePage.temaActual.contrato1}" immediate="true" rendered="#{notaContablePage.temaActual.tema.contrato1 eq 'S'}">
													<a4j:support event="onchange" action="#{notaContablePage.cambiarContratoPartida}" reRender="tercero1,tercero2" />
													<f:selectItem itemValue="" itemLabel="Seleccione una opcion" />
													<f:selectItems value="#{notaContablePage.contratos1}" />
												</h:selectOneMenu>
											</h:panelGrid>	
										</h:panelGrid>
										
									</rich:panel>
								</h:panelGrid>
							</rich:panel>
							<rich:panel header="Contra Partida"  style="width: 400px; " >
			
								<h:panelGrid columns="1" width="100%" cellpadding="0" cellspacing="0">
									<h:panelGrid columns="5" >
										<h:outputText  styleClass="bold" value="Cuenta" />
										<h:outputText  styleClass="bold" value="#{notaContablePage.temaActual.tema.contraPartidaContable}" style="font-weight: bold;"/>
										<rich:spacer width="50"/>				
										<h:outputText  styleClass="bold" value="Naturaleza" />
										<h:outputText  styleClass="bold" value="#{notaContablePage.temaActual.tema.naturaleza2 eq 'D'?'Debe':'Haber'}" style="font-weight: bold;"/>
									</h:panelGrid>
									<h:panelGrid columns="2"  width="100%" id="sucursalContraPartida">
										<h:outputText  styleClass="bold" value="Sucursal Destino"/>
										<h:outputText  styleClass="bold" value="#{notaContablePage.usuarioLogueado.sucursal.codigo} #{notaContablePage.usuarioLogueado.sucursal.nombre}" rendered="#{notaContablePage.nota.concepto.origenDestino eq 'S'}" />
										<h:selectOneMenu value="#{notaContablePage.temaActual.codigoSucursalDestinoContraPartida}" immediate="true"  rendered="#{notaContablePage.nota.concepto.origenDestino eq 'N'}"  style="width: 280px;">
											<a4j:support event="onchange" action="#{notaContablePage.cambiarSucursalContraPartida}" reRender="sucursalPartida,sucursalContraPartida" />
											<f:selectItem itemValue=" " itemLabel="Seleccione una opcion" />
											<f:selectItems value="#{notaContablePage.sucursalesContraPartida}" />
										</h:selectOneMenu>
										
										<h:outputText  styleClass="bold" value="Referencia" rendered="#{notaContablePage.temaActual.tema.referencia2 eq 'S'}"/>
										<h:inputText value="#{notaContablePage.temaActual.referencia2}" rendered="#{notaContablePage.temaActual.tema.referencia2 eq 'S'}"  maxlength="12" size="12" onkeypress="return onKeyPressNumbersNoZero(event, this.value)"/>
									</h:panelGrid>
									<rich:panel header="Tercero" rendered="#{notaContablePage.temaActual.tema.tercero2 eq 'S'}" style="width:100%; ">
										<h:panelGrid columns="2"  id="documentoTercero2">
											<h:outputText  styleClass="bold" value="Tipo de documento" />
											<h:selectOneMenu value="#{notaContablePage.temaActual.tipoIdentificacion2}" immediate="true" >
												<a4j:support event="onchange" reRender="filtroTercero2,tercero2" status="none" >
													<a4j:actionparam value="" assignTo="#{notaContablePage.temaActual.nombreCompleto2}"/>
												</a4j:support>
												<f:selectItem itemValue="" itemLabel="Seleccione una opcion" />
												<f:selectItems value="#{notaContablePage.tiposDoc}" />
											</h:selectOneMenu>
											
											<h:outputText  styleClass="bold" value="Numero Documento" />
											<h:panelGrid columns="2">
												<h:inputText value="#{notaContablePage.temaActual.numeroIdentificacion2}" size="20" immediate="true">
													<a4j:support event="onkeyup" reRender="filtroTercero2,tercero2" status="none" >
														<a4j:actionparam  name="numDocRenN2" value="" assignTo="#{notaContablePage.temaActual.nombreCompleto2}"/>
													</a4j:support>
												</h:inputText>
												<h:panelGrid columns="1" id="filtroTercero2" cellspacing="0" cellpadding="0">
													<a4j:commandButton action="#{notaContablePage.buscarTercero2}" reRender="documentoTercero2,tercero2" value="Buscar" status="status" 
													rendered="#{!empty notaContablePage.temaActual.tipoIdentificacion2 and !empty notaContablePage.temaActual.numeroIdentificacion2}"/>
												</h:panelGrid>
											</h:panelGrid>	
										</h:panelGrid>
										
										<h:panelGrid columns="1" id="tercero2" cellpadding="0" cellspacing="0">
											<h:panelGrid columns="2" rendered="#{! empty notaContablePage.temaActual.nombreCompleto2}"  cellpadding="0" cellspacing="0">
												<h:outputText  styleClass="bold" value="Dígito de Verificación" />
												<h:outputText  styleClass="bold" value="#{notaContablePage.temaActual.digitoVerificacion2}" />
											
												<h:outputText  styleClass="bold" value="Nombre" />
												<h:outputText  styleClass="bold" value="#{notaContablePage.temaActual.nombreCompleto2}" />
											
												<h:outputText  styleClass="bold" value="Contrato" rendered="#{notaContablePage.temaActual.tema.contrato2 eq 'S'}"/>
												<h:selectOneMenu value="#{notaContablePage.temaActual.contrato2}" immediate="true" rendered="#{notaContablePage.temaActual.tema.contrato2 eq 'S'}">
													<a4j:support event="onchange" action="#{notaContablePage.cambiarContratoContraPartida}" reRender="tercero1,tercero2" />
													<f:selectItem itemValue="" itemLabel="Seleccione una opcion" />
													<f:selectItems value="#{notaContablePage.contratos2}" />
												</h:selectOneMenu>
											</h:panelGrid>
										</h:panelGrid>
										
									</rich:panel>
								</h:panelGrid>
							</rich:panel>
						</h:panelGrid>
						<h:panelGrid columns="2" width="100%" cellpadding="0" cellspacing="2">
						
							
							<h:outputText  styleClass="bold" value="Descripción" />
							<h:inputTextarea value="#{notaContablePage.temaActual.descripcion}" cols="139" rows="2" />
		
							<h:outputText  styleClass="bold" value="Divisa" />
							<h:panelGrid columns="4" width="100%" cellpadding="0" cellspacing="0">
								<h:selectOneMenu value="#{notaContablePage.temaActual.codigoDivisa}" immediate="true" style="width:180px;" id="codDivisaNotaContable">
									<f:selectItems value="#{notaContablePage.divisas}" />
								</h:selectOneMenu>
								
								<h:outputText  styleClass="bold" value="Importe" style="width:150px;"/>
								<h:inputText value="#{notaContablePage.temaActual.monto}" size="20" maxlength="20" onkeypress="return onKeyPressNumbers(event,this.value);" converter="javax.faces.Double" immediate="true" converterMessage="Valor invalido para el Importe" onblur="validarMontoAlert(this.value)">
									<f:convertNumber maxFractionDigits="2"/>
									<a4j:support event="onkeyup" reRender="importe, impuestos"  status="none" action="#{notaContablePage.ajustarCargaImpositiva}"/>
								</h:inputText>
								<h:panelGrid columns="1" id="importe" width="250" cellpadding="0" cellspacing="0">
									<h:outputText  styleClass="bold" value="#{notaContablePage.temaActual.monto}" ><f:convertNumber type="currency" /></h:outputText>
								</h:panelGrid>
							</h:panelGrid>
							
						</h:panelGrid>
						<h:panelGrid columns="1" cellpadding="0" cellspacing="2" id="impuestos" style="text-align: center;" width="100%">
							<rich:dataTable value="#{notaContablePage.temaActual.impuestoTema}" var="imp" id="table" rowKeyVar="rowKey" rendered="#{! empty notaContablePage.temaActual.impuestoTema}"
							onRowMouseOver="this.style.backgroundColor='#9fbdeb'" onRowMouseOut="this.style.backgroundColor='#{a4jSkin.rowBackgroundColor}'" rowClasses="row1, row2">
								
								<f:facet name="header"><h:outputText  styleClass="bold" value="Liquidación de Impuestos" /></f:facet>
								
								<rich:column width="150" style="text-align: left;">
									<f:facet name="header"><h:outputText  styleClass="bold" value="Nombre" /></f:facet>
									<h:outputText  styleClass="bold" value="#{imp.impuestoTema.impuesto.nombre}" /> 
								</rich:column>
								
								<rich:column width="80" style="text-align: right;">
									<f:facet name="header"><h:outputText  styleClass="bold" value="Porcentaje" /></f:facet>
									<h:outputText  styleClass="bold" value="#{imp.impuestoTema.impuesto.valor}%" /> 
								</rich:column>
								
								<rich:column width="140" style="text-align: right;">
									<f:facet name="header"><h:outputText  styleClass="bold" value="Base" /></f:facet>
									<h:outputText  styleClass="bold" rendered="#{not imp.boolExonera}"  value="#{imp.base}" converter="javax.faces.Double" ><f:convertNumber type="currency" maxFractionDigits="2" /></h:outputText> 
									<h:outputText  styleClass="bold" rendered="#{imp.boolExonera}" value="NA"/>
								</rich:column>
		
								<rich:column width="140" style="text-align: right;">
									<f:facet name="header"><h:outputText  styleClass="bold" value="Calculado" /></f:facet>
									<h:outputText  styleClass="bold" rendered="#{not imp.boolExonera}" value="#{imp.calculado}" converter="javax.faces.Double" ><f:convertNumber type="currency" maxFractionDigits="2"/></h:outputText>
									<h:outputText  styleClass="bold" rendered="#{imp.boolExonera}" value="NA"/>
								</rich:column>
		
								<rich:column  width="80" style="text-align: center;">
									<f:facet name="header"><h:outputText  styleClass="bold" value="Exonerar" /></f:facet>
									<h:selectBooleanCheckbox value="#{imp.boolExonera}" immediate="true">
										<a4j:support event="onchange" reRender="impuestos"  status="none" action="#{notaContablePage.ajustarCargaImpositiva}"/>
									</h:selectBooleanCheckbox> 
								</rich:column>
							</rich:dataTable>
						</h:panelGrid>
						<!-- seccion de soportes -->
						<rich:modalPanel id="modalSoportes" domElementAttachment="form" autosized="true">
							<f:facet name="header">
								<h:panelGroup><h:outputText  styleClass="bold" value="Subir soportes para el tema: #{notaContablePage.temaActual.tema.nombre}"/></h:panelGroup>
							</f:facet>
							<f:facet name="controls">
								<h:panelGroup>
									<h:graphicImage value="../../../common/images/close.png" alt="cerrar" styleClass="hidelink" id="hidelinkSoportes" height="20" width="20" />
									<rich:componentControl for="modalSoportes" attachTo="hidelinkSoportes" operation="hide" event="onclick" />
								</h:panelGroup>
							</f:facet>
							<h:panelGrid width="550">
								<h:panelGrid columns="1" width="100%">
						            <rich:fileUpload listWidth="100%" fileUploadListener="#{notaContablePage.listener}" id="upload" acceptedTypes="*" uploadControlLabel="Enviar" cancelEntryControlLabel="Cancelar" 
						           immediateUpload="true" addControlLabel="Agregar" clearAllControlLabel="Limpiar Reporte de Carga" clearControlLabel="" doneLabel="El archivo ha sido enviado satisfactoriamente al servidor" progressLabel="Procesando..." 
						           transferErrorLabel="Error transfiriendo el archivo"  sizeErrorLabel="El Archivo supera el límite permitido. (200 KB)" >
						         	  <a4j:support event="onfileuploadcomplete" reRender="anexos"  />
						            </rich:fileUpload>
						        </h:panelGrid>
							</h:panelGrid>
						</rich:modalPanel>	
						<h:panelGrid columns="1" cellpadding="0" cellspacing="2" id="anexos" style="text-align: center;" width="100%">
							

						
							<rich:dataTable value="#{notaContablePage.temaActual.anexoTema}" var="anexo" id="tableAnexos" rowKeyVar="rowKeyAnexos" rendered="#{! empty notaContablePage.temaActual.anexoTema}"
							onRowMouseOver="this.style.backgroundColor='#9fbdeb'" onRowMouseOut="this.style.backgroundColor='#{a4jSkin.rowBackgroundColor}'" rowClasses="row1, row2">
								
								<f:facet name="header"><h:outputText  styleClass="bold" value="Soportes del tema" /></f:facet>
								
								<rich:column width="150" style="text-align: left;">
									<f:facet name="header"><h:outputText  styleClass="bold" value="Fecha" /></f:facet>
									<h:outputText  styleClass="bold" value="#{anexo.fechaHora}" /> 
								</rich:column>
								
								<rich:column style="text-align: right;">
									<f:facet name="header"><h:outputText  styleClass="bold" value="Usuario" /></f:facet>
									<h:outputText  styleClass="bold" value="#{anexo.usuNombre}" /> 
								</rich:column>
								
								<rich:column style="text-align: right;">
									<f:facet name="header"><h:outputText  styleClass="bold" value="Archivo" /></f:facet>
									<a4j:htmlCommandLink action="#{downloadGeneralPage.download}" styleClass="bold" value="#{anexo.nombre}" target="_blank">
										<a4j:actionparam name="type1" value="#{downloadGeneralPage.SOPORTE}" assignTo="#{downloadGeneralPage.type}"/>
										<a4j:actionparam name="file1" value="#{anexo.archivo}" assignTo="#{downloadGeneralPage.file}"/>
									</a4j:htmlCommandLink>
									
								</rich:column>
		
								<rich:column width="80" style="text-align: center;">
									<f:facet name="header"><h:outputText  styleClass="bold" value="Eliminar" /></f:facet>
									<a4j:commandButton image="/common/images/delete.png" alt="Borrar" onclick="#{rich:component('popupBorrar')}.show()"/>
									
									<!-- Formulario de confirmacion de borrado de anexos-->
									<rich:modalPanel id="popupBorrar" autosized="true" domElementAttachment="form" minWidth="300">
										<f:facet name="header">
											<h:panelGroup><h:outputText  styleClass="bold" value="Confirmación de borrado de anexo"/></h:panelGroup>
										</f:facet>
										
										<h:panelGrid columns="1" width="100%">
											
											<h:outputText  styleClass="bold" value="Está seguro que desea borrar el anexo actual?" />
								
											<!-- Seccion de mensajes y botones de envio y cancelacion-->
											<ui:include src="../../common/mensajes.xhtml" /> 
											<h:panelGrid columns="2" styleClass="center" width="100%">
												<a4j:commandButton action="#{notaContablePage.borrarAnexo}" value="Si" oncomplete="#{rich:component('popupBorrar')}.hide()" immediate="true" reRender="anexos" >
													<a4j:actionparam name="anexoBorrar" value="true" assignTo="#{anexo.borrar}" converter="javax.faces.Boolean" />
												</a4j:commandButton>
												<a4j:commandButton onclick="#{rich:component('popupBorrar')}.hide()" value="No" />
											</h:panelGrid>
										</h:panelGrid>
									</rich:modalPanel>
								</rich:column>
		
							</rich:dataTable>
						</h:panelGrid>
								
					</h:panelGrid>
					
					<ui:include src="../../common/mensajes.xhtml" /> 
				</div>
			</h:outputText>
			<h:panelGrid columns="2" styleClass="center" width="100%" id="opcionesTemaNotaContable" cellspacing="0" cellpadding="0">
				<a4j:commandButton value="Guardar" action="#{notaContablePage.guardarTema}" reRender="informacion,formulario" oncomplete="if (#{facesContext.maximumSeverity.ordinal==0}) #{rich:component('editor')}.hide();" />
				<a4j:commandButton oncomplete="#{rich:component('popupCancelTema')}.show()" value="Cancelar" />
					
				<!-- Modal para cancelación de datos de riesgo-->
				<rich:modalPanel id="popupCancelTema" autosized="true" domElementAttachment="form" width="450">
					<f:facet name="header">
						<h:panelGroup><h:outputText  styleClass="bold" value="Confirmación de cancelación de registro de tema"/></h:panelGroup>
					</f:facet>
					
					<h:panelGrid columns="1" width="100%">
						
						<h:outputText  styleClass="bold" value="Si cancela se perderá toda la información registrada asociada al tema actual" />
						<h:outputText  styleClass="bold" value="Está seguro que desea cancelar y borrar la información?" />
			
						<!-- Seccion de mensajes y botones de envio y cancelacion-->
						<h:panelGrid columns="2" styleClass="center" width="100%">
							<a4j:commandButton action="#{notaContablePage.cancelarTema}" value="Si" oncomplete="#{rich:component('editor')}.hide(); #{rich:component('popupCancelTema')}.hide();" reRender="formulario"/>
							<a4j:commandButton onclick="#{rich:component('popupCancelTema')}.hide()" value="No"   immediate="true" />
						</h:panelGrid>
					</h:panelGrid>
				</rich:modalPanel>
				
				<!-- seccion de riesgo operacional -->
				<rich:modalPanel id="modalRiesgo" domElementAttachment="form" autosized="true">
					<f:facet name="header">
						<h:panelGroup><h:outputText  styleClass="bold" value="Riesgo operacional para el tema: #{notaContablePage.temaActual.tema.nombre}"/></h:panelGroup>
					</f:facet>
					<h:panelGrid width="550">
						<h:panelGrid columns="3" width="100%">
							<h:outputText  styleClass="bold" value="Importe Total" style="width:150px;"/>
							<h:inputText value="#{notaContablePage.temaActual.riesgoOperacional.importeTotal}"  size="16" maxlength="16" onkeypress="return onKeyPressNumbers(event,this.value);" converter="javax.faces.Double" immediate="true" converterMessage="Valor no válido para el Importe Total">
								<f:convertNumber maxFractionDigits="2" />
								<a4j:support event="onkeyup" reRender="importeTotal" status="none"  />
							</h:inputText>
							<h:panelGrid columns="1" id="importeTotal" width="250" cellpadding="0" cellspacing="0">
								<h:outputText  styleClass="bold" value="#{notaContablePage.temaActual.riesgoOperacional.importeTotal}" ><f:convertNumber type="currency" /></h:outputText>
							</h:panelGrid>

							<h:outputText  styleClass="bold" value="Importe Parcial" style="width:150px;"/>
							<h:inputText value="#{notaContablePage.temaActual.riesgoOperacional.importeParcial}"  size="16" maxlength="16" onkeypress="return onKeyPressNumbers(event,this.value);" converter="javax.faces.Double" immediate="true"  converterMessage="Valor no válido para el Importe Parcial">
								<f:convertNumber maxFractionDigits="2" />
								<a4j:support event="onkeyup" reRender="importeParcial"   status="none"/>
							</h:inputText>
							<h:panelGrid columns="1" id="importeParcial" width="250" cellpadding="0" cellspacing="0">
								<h:outputText  styleClass="bold" value="#{notaContablePage.temaActual.riesgoOperacional.importeParcial}" ><f:convertNumber type="currency" /></h:outputText>
							</h:panelGrid>
						</h:panelGrid>
						<h:panelGrid columns="2" width="100%" id="selectsRiesgo">

							<h:outputText  styleClass="bold" value="Fecha Inicial del Evento" />
							<rich:calendar value="#{notaContablePage.temaActual.riesgoOperacional.fechaEvento}" isDayEnabled="isDayEnabledRiesgoNC" dayStyleClass="getDisabledStyleRiesgoNC" immediate="true" id="fechaEvento"/>
							
							<h:outputText  styleClass="bold" value="Fecha Finalización del Evento" />
							<rich:calendar value="#{notaContablePage.temaActual.riesgoOperacional.fechafinEvento}" isDayEnabled="isDayEnabledRiesgoNC" 
							dayStyleClass="getDisabledStyleRiesgoNC" immediate="true" id="fechaFinEvento"/>
																					
                       </h:panelGrid> 
                            
                          <h:panelGrid columns="4" width="90%" id="selectstiempo">
                            <h:outputText  styleClass="bold" value="Hora Inicio Evento" /> 
							<h:selectOneMenu value="#{notaContablePage.temaActual.riesgoOperacional.horaInicioEvento}"  immediate="true" >  
							
							    <h:outputText  styleClass="bold" value="hh" /> 
							    <f:selectItem itemValue="" itemLabel="00" />
								<f:selectItems value="#{notaContablePage.horas}" />
							</h:selectOneMenu>
							
							  
							 <h:selectOneMenu value="#{notaContablePage.temaActual.riesgoOperacional.minutosInicioEvento}"  immediate="true" >  
								<h:outputText  styleClass="bold" value="mm" /> 
								<f:selectItem itemValue="" itemLabel="--" />
								<f:selectItems value="#{notaContablePage.minutos}" />
						    </h:selectOneMenu>
						   
						 
						    <h:selectOneMenu value="#{notaContablePage.temaActual.riesgoOperacional.horario}"  immediate="true" > 
						        <h:outputText  styleClass="bold" value="a.m/p.m" />  
								<f:selectItem itemValue="" itemLabel= "--" />
								<f:selectItems value="#{notaContablePage.horario}" />
						    </h:selectOneMenu>
						    
						  
							<h:outputText  styleClass="bold" value="Hora Finalizacion Evento" />  
							<h:selectOneMenu value="#{notaContablePage.temaActual.riesgoOperacional.horaFinalEvento}"  immediate="true" >  
							    <h:outputText  styleClass="bold" value="hh" /> 
							    <f:selectItem itemValue="" itemLabel="00" />
								<f:selectItems value="#{notaContablePage.horas}" />
							</h:selectOneMenu>
							
							 
							<h:selectOneMenu value="#{notaContablePage.temaActual.riesgoOperacional.minutosFinalEvento}"  immediate="true" >  
							    <h:outputText  styleClass="bold" value="mm" /> 
							  	<f:selectItem itemValue="" itemLabel="--" />
								<f:selectItems value="#{notaContablePage.minutos}" />
						    </h:selectOneMenu>
						    
						    <h:selectOneMenu value="#{notaContablePage.temaActual.riesgoOperacional.horariofinal}"  immediate="true" >  
							    <h:outputText  styleClass="bold" value="a.m/p.m" /> 
							  	<f:selectItem itemValue="" itemLabel="--" />
								<f:selectItems value="#{notaContablePage.horario}" />
						    </h:selectOneMenu>
						   						 				    
						      <h:outputText  styleClass="bold" value="Hora Descubrimiento" />  
							<h:selectOneMenu value="#{notaContablePage.temaActual.riesgoOperacional.horaDescubrimiento}"  immediate="true" >
							 	<h:outputText  styleClass="bold" value="hh" /> 
								<f:selectItem itemValue="" itemLabel="00" />
								<f:selectItems value="#{notaContablePage.horas}" />
							</h:selectOneMenu>
							  
							<h:selectOneMenu value="#{notaContablePage.temaActual.riesgoOperacional.minutosDescubrimiento}"  immediate="true" >  
							 	<h:outputText  styleClass="bold" value="mm" />
							 	<f:selectItem itemValue="" itemLabel="--" />
								<f:selectItems value="#{notaContablePage.minutos}" />
						    </h:selectOneMenu>
						    
						     <h:selectOneMenu value="#{notaContablePage.temaActual.riesgoOperacional.horariodescubre}"  immediate="true" >  
								<h:outputText  styleClass="bold" value="a.m/p.m" /> 
								<f:selectItem itemValue="" itemLabel= "--" />
								<f:selectItems value="#{notaContablePage.horario}" />
						    </h:selectOneMenu>
						  </h:panelGrid> 
                 
                        <h:panelGrid columns="2" width="100%" id="selectsRiesgoDos">
							<h:outputText  styleClass="bold" value="Fecha del Descubrimiento" />
							<rich:calendar value="#{notaContablePage.temaActual.riesgoOperacional.fechaDescubrimientoEvento}" isDayEnabled="isDayEnabledRiesgoNC" 
							dayStyleClass="getDisabledStyleRiesgoNC" immediate="true" id="fechaDescubrimiento"/>
						
						   
						   	<h:outputText  styleClass="bold" value="Clase de Riesgo" />
							<h:selectOneMenu value="#{notaContablePage.temaActual.riesgoOperacional.codigoClaseRiesgo}" immediate="true" >
								<a4j:support event="onchange" action="#{notaContablePage.buscarPerdidasCuenta}" reRender="IdPanel" />
								<f:selectItem itemValue="" itemLabel="Seleccione una opcion" />
								<f:selectItems value="#{notaContablePage.clasesRiesgo}" />
						    </h:selectOneMenu>
							
						 		   
						   <h:outputText  styleClass="bold" value="Perdida Operacional" />
							<a4j:outputPanel id="IdPanel">		
							<h:selectOneMenu value="#{notaContablePage.temaActual.riesgoOperacional.codigoTipoPerdida}" immediate="true" >
								<f:selectItem itemValue="" itemLabel="Seleccione una opcion" />
								<f:selectItems value="#{notaContablePage.perdidaOper}" />
							 </h:selectOneMenu>
							</a4j:outputPanel>
							

							<h:outputText  styleClass="bold" value="Proceso" />
							<h:selectOneMenu value="#{notaContablePage.temaActual.riesgoOperacional.codigoProceso}" immediate="true" >
								<f:selectItem itemValue="" itemLabel="Seleccione una opcion" />
								<f:selectItems value="#{notaContablePage.procesos}" />
							</h:selectOneMenu>

							<h:outputText  styleClass="bold" value="Línea Operativa" />
							<h:selectOneMenu value="#{notaContablePage.temaActual.riesgoOperacional.codigoLineaOperativa}" immediate="true" >
								<f:selectItem itemValue="" itemLabel="Seleccione una opcion" />
								<f:selectItems value="#{notaContablePage.lineasOperativas}" />
							</h:selectOneMenu>

							<h:outputText  styleClass="bold" value="Producto Afectado" />
							<h:selectOneMenu value="#{notaContablePage.temaActual.riesgoOperacional.codigoProducto}" immediate="true" >
								<f:selectItem itemValue="" itemLabel="Seleccione una opcion" />
								<f:selectItems value="#{notaContablePage.productos}" />
							</h:selectOneMenu>
						</h:panelGrid>
						<ui:include src="../../common/mensajes.xhtml" /> 
						<h:panelGrid columns="3" width="100%" style="text-align: center;">
							<a4j:commandButton value="Guardar" action="#{notaContablePage.guardarRiesgo}" oncomplete="if (#{facesContext.maximumSeverity.ordinal==0}) #{rich:component('modalRiesgo')}.hide();" />
							<a4j:commandButton oncomplete="#{rich:component('popupCancelRiesgo')}.show()" value="Cancelar" />
								
							<!-- Modal para cancelación de datos de riesgo-->
							<rich:modalPanel id="popupCancelRiesgo" autosized="true" domElementAttachment="form" width="450">
								<f:facet name="header">
									<h:panelGroup><h:outputText  styleClass="bold" value="Confirmación de cancelación de registro de información"/></h:panelGroup>
								</f:facet>
								
								<h:panelGrid columns="1" width="100%">
									
									<h:outputText  styleClass="bold" value="Si cancela se perderá toda la información registrada asociada a riesgo operacional" />
									<h:outputText  styleClass="bold" value="Está seguro que desea cancelar y borrar la información?" />
						
									<!-- Seccion de mensajes y botones de envio y cancelacion-->
									<h:panelGrid columns="2" styleClass="center" width="100%">
										<a4j:commandButton action="#{notaContablePage.cancelarRiesgo}" value="Si" reRender="formulario" oncomplete="#{rich:component('modalRiesgo')}.hide(); #{rich:component('popupCancelRiesgo')}.hide();"/>
										<a4j:commandButton onclick="#{rich:component('popupCancelRiesgo')}.hide()" value="No"  immediate="true"/>
									</h:panelGrid>
								</h:panelGrid>
							</rich:modalPanel>
						</h:panelGrid>
						
					</h:panelGrid>
				</rich:modalPanel>	
				
			</h:panelGrid>
		</h:panelGrid>
	</rich:modalPanel>
	
	<h:panelGrid columns="1" width="100%" cellpadding="0" cellspacing="0" id="formulario">
		<rich:panel header="Información básica" style="width: 100%;" >
			<h:panelGrid columns="2">
				<h:outputText  styleClass="bold" value="Sucursal de Origen" />
				<h:outputText  styleClass="bold" value="#{notaContablePage.usuarioLogueado.usuario.codigoAreaModificado} - #{notaContablePage.usuarioLogueado.usuario.nombreAreaModificado}" />
				<h:outputText  styleClass="bold" value="Concepto" />
				<h:panelGrid columns="2" id="tipoConcepto">
					<h:inputText value="#{notaContablePage.concepto}" size="70"/>
					<a4j:commandButton action="#{notaContablePage.buscarConcepto}" value="Buscar Concepto" reRender="tipoConcepto"/>

					<h:selectOneMenu value="#{notaContablePage.nota.codigoConcepto}" immediate="true" converter="javax.faces.Integer" id="nombreCon"  disabledClass="disabledItem" rendered="#{! empty notaContablePage.conceptos}">
						<a4j:support event="onchange" action="#{notaContablePage.seleccionarConcepto}" reRender="formulario" status="status" />
						<f:selectItem itemValue="-1" itemLabel="Seleccione una opcion" />
						<f:selectItems value="#{notaContablePage.conceptos}" />
					</h:selectOneMenu>
				</h:panelGrid>

				<h:outputText  styleClass="bold" value="Tipo de Evento" />
				<h:selectOneMenu value="#{notaContablePage.nota.codigoTipoEvento}" immediate="true" converter="javax.faces.Integer">
					<f:selectItem itemValue="-1" itemLabel="Seleccione una opcion" />
					<f:selectItems value="#{notaContablePage.tiposEvento}" />
				</h:selectOneMenu>
	
			</h:panelGrid> 
		</rich:panel>
		<rich:panel header="Temas del Concepto" style="width: 100%;" rendered="#{notaContablePage.nota.codigoConcepto gt 0}">
			<rich:dataTable value="#{notaContablePage.temasNotaContable}" var="temaNota" id="tableTemas" rendered="#{! empty notaContablePage.temasNotaContable}" rowKeyVar="rowKey" width="100%"
			onRowMouseOver="this.style.backgroundColor='#9fbdeb'" onRowMouseOut="this.style.backgroundColor='#{a4jSkin.rowBackgroundColor}'" rowClasses="row1, row2">
				
				<rich:column>
	                      <f:facet name="header"><h:outputText value="Nombre del Tema" /></f:facet>
	                      <h:outputText value="#{temaNota.tema.nombre} " />
	                  </rich:column>
				
				<rich:column>
	                      <f:facet name="header"><h:outputText value="Partida" /></f:facet>
	                      <h:outputText value="#{temaNota.tema.partidaContable} " />
	                  </rich:column>
				
				<rich:column>
                    <f:facet name="header"><h:outputText value="Contrapartida" /></f:facet>
                    <h:outputText value="#{temaNota.tema.contraPartidaContable} " />
                </rich:column>
				
				<rich:column style="text-align: center;">
                    <f:facet name="header"><h:outputText value="Soportes" /></f:facet>
                    <h:outputText value="#{notaContablePage.nota.concepto.soportes eq 'S'?'Si':'No'}" />
                </rich:column>
				
				<rich:column style="text-align: center;">
                    <f:facet name="header"><h:outputText value="Riesgo" /></f:facet>
                    <h:outputText value="#{temaNota.tema.riesgoOperacional eq 'S'?'Si':'No'}" />
                </rich:column>
				
				<rich:column>
                    <f:facet name="header"><h:outputText value="Divisa" /></f:facet>
                    <h:outputText value="#{temaNota.codigoDivisa}" />
                </rich:column>
				
				<rich:column style="text-align: right;">
                    <f:facet name="header" ><h:outputText value="Importe" /></f:facet>
                    <h:outputText value="#{temaNota.monto}" ><f:convertNumber type="currency" /></h:outputText>
                </rich:column>
				
				<rich:column style="text-align: center;">
                    <f:facet name="header"><h:outputText value="Editar" /></f:facet>
                    <a4j:commandButton action="#{notaContablePage.editar}" oncomplete="#{rich:component('editor')}.show()" reRender="editor" image="/common/images/edit.png" alt="Editar" rendered="#{temaNota.autorizada}">
                    	<a4j:actionparam name="codigoTema" value="#{temaNota.codigo}" assignTo="#{notaContablePage.codigo}" converter="javax.faces.Integer" />
                    </a4j:commandButton>
                </rich:column>
                <f:facet name="footer" >
					<rich:columnGroup rendered="#{! empty notaContablePage.totalesNota}">
						<rich:column colspan="5" style="text-align:right;"><h:outputText value="Totales" /></rich:column>
						<rich:column style="padding: 0px;">
							<rich:dataTable style="border-width: 0px; background-color: transparent;" value="#{notaContablePage.totalesNota}" var="total" >
								<rich:column style="border-width: 0px;"><h:outputText value="#{total.codigoDivisa }" /></rich:column>
							</rich:dataTable>
						</rich:column>
						<rich:column style="padding: 0px;">
							<rich:dataTable style="border-width: 0px; background-color: transparent;" value="#{notaContablePage.totalesNota}" var="total" >
								<rich:column  style="border-width: 0px; text-align:right;"><h:outputText value="#{total.total}" ><f:convertNumber type="currency" /></h:outputText></rich:column>
							</rich:dataTable>
						</rich:column>
						<rich:column ></rich:column>
					</rich:columnGroup>
				</f:facet>
			</rich:dataTable>
		</rich:panel>
		
	
		<h:panelGrid columns="3" styleClass="center" width="100%" id="botonesNotaContable">
			<a4j:commandButton action="#{notaContablePage.guardarNota}" reRender="formulario,botonesNotaContable"  value="Enviar a Visto Bueno" rendered="#{notaContablePage.nota.codigo le 0 and ! empty notaContablePage.totalesNota}"/>
			<a4j:commandButton action="#{notaContablePage.guardarNota}" oncomplete="#{rich:component('popupNotaContable')}.hide()" reRender="lista,botonesNotaContable"  value="Enviar a Visto Bueno" rendered="#{notaContablePage.nota.codigo gt 0 and notaContablePage.nota.puedeEditar}"/>
			<a4j:commandButton value="Anular" rendered="#{notaContablePage.nota.puedeAnular}" oncomplete="#{rich:component('popupAnularNota')}.show()" />
			<a4j:commandButton value="Cancelar" action="#{notaContablePage.cancelarNota}" reRender="formulario" rendered="#{notaContablePage.nota.codigo le 0}"/>
			<a4j:commandButton value="Cerrar" oncomplete="#{rich:component('popupNotaContable')}.hide()" reRender="lista" rendered="#{notaContablePage.nota.codigo gt 0}"/>
		</h:panelGrid>
	</h:panelGrid>
</ui:composition>